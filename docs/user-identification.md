# User Identification Standardization

This document outlines our approach to standardizing user identification across the application.

## Overview

Our application uses a dual-field approach for user identification:

1. **Firebase UID (`firebaseUid`)**: The unique identifier generated by Firebase Authentication
2. **Username (`username`)**: A user-chosen, human-readable identifier

## Field Naming Convention

We use consistent field names across all collections and code:

- `firebaseUid`: The Firebase Authentication UID (e.g., "87m5IWrx3pUplWg2eKVyg76bM5g1")
- `username`: The user-chosen, human-readable identifier (e.g., "KyleNowak")
- `name`: The user's display name (can be different from username)

## Data Structure

### User Profiles

User profiles are stored in the `users` collection with the Firebase UID as the document ID:

```typescript
interface UserProfile {
  firebaseUid: string;      // Primary key, used for document ID
  username: string;         // Unique, user-chosen identifier
  name: string;             // Display name
  // ... other fields
}
```

### Posts

Posts reference users with both Firebase UID and username:

```typescript
interface Post {
  id: string;
  question: string;
  firebaseUid: string;      // Creator's Firebase UID
  username: string;         // Creator's username
  name: string;             // Creator's display name
  // ... other fields
}
```

## Implementation Details

### User Creation

When a new user is created:

1. The user document is stored with the Firebase UID as the document ID
2. A unique username is generated or chosen by the user
3. Both identifiers are stored in the user document

### User Lookup

Users can be looked up by either identifier:

1. By Firebase UID: Direct document lookup in the `users` collection
2. By username: Query with a where clause on the `username` field

### References in Other Collections

When referencing users from other collections:

1. Always store both `firebaseUid` and `username`
2. Use `firebaseUid` for security rules and backend operations
3. Use `username` for user-facing displays and URLs

## Backward Compatibility

During the transition period:

1. The application handles both old and new field names
2. The migration script updates existing documents to the new format
3. Queries check both old and new field names when necessary

## Security Considerations

1. Firebase UID is used for authentication and authorization
2. Username is only used for display and user-friendly URLs
3. Security rules should always validate against the Firebase UID

## Best Practices

When implementing new features:

1. Always use the standardized field names
2. Store both identifiers when referencing users
3. Use Firebase UID for security-sensitive operations
4. Use username for user-facing interfaces 