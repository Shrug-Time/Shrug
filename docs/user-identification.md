# User Identification in Shrug

This document describes the user identification system in the Shrug application, including the dual-field approach, field standardization, and best practices for working with user IDs.

## Introduction

Shrug uses a dual-field identification system for users, providing two distinct ways to identify and reference users throughout the application:

1. **Firebase UID (`firebaseUid`)** - The system-generated unique identifier from Firebase Authentication
2. **Username (`username`)** - A human-readable, user-chosen identifier

This approach provides both technical robustness and user-friendly references.

## Standardized Fields

### Core Identity Fields

| Field Name | Type | Description |
|------------|------|-------------|
| `firebaseUid` | string | The unique identifier generated by Firebase Authentication |
| `username` | string | A unique, user-chosen identifier (3-15 characters, alphanumeric, dashes, underscores) |
| `name` | string | The display name for the user (not necessarily unique) |

### Legacy Fields (For Backward Compatibility)

| Legacy Field | Standardized Equivalent | Notes |
|--------------|-------------------------|-------|
| `userId` | `firebaseUid` | Used in older versions to refer to the Firebase UID |
| `userID` | `username` | Used in older versions to refer to the username |
| `userName` | `name` | Used in older versions to refer to the display name |

## Data Model

The `UserProfile` interface in `src/types/models.ts` defines the complete user data structure, including:

```typescript
interface UserProfile extends TimestampedEntity {
  // Core identity fields (standardized)
  firebaseUid: string;
  username: string;
  name: string;
  
  // Profile content
  email: string;
  bio?: string;
  photoURL?: string;
  
  // Status fields
  verificationStatus: 'unverified' | 'email_verified' | 'identity_verified';
  membershipTier: 'free' | 'basic' | 'premium';
  
  // ... other fields ...
  
  // Legacy fields for backward compatibility
  userID?: string;
  userId?: string;
  userName?: string;
}
```

## Using the User ID Helpers

The application provides helper utilities in `src/utils/userIdHelpers.ts` to work with user identifiers:

### Detecting ID Type

```typescript
import { detectUserIdentifierType } from '@/utils/userIdHelpers';

const idType = detectUserIdentifierType('some-username'); // Returns 'username'
// or
const idType = detectUserIdentifierType('aBcDeFgHiJkLmNoPqRsTuVwXyZ123'); // Returns 'firebaseUid'
```

### Extracting User Identifiers

```typescript
import { extractUserIdentifier } from '@/utils/userIdHelpers';

// Extract Firebase UID
const firebaseUid = extractUserIdentifier(userProfile, 'firebaseUid');

// Extract username
const username = extractUserIdentifier(userProfile, 'username');
```

### Creating Firestore Queries

```typescript
import { createUserIdentifierQuery } from '@/utils/userIdHelpers';

// This returns an array of field/value pairs to use in queries
const queryConstraints = createUserIdentifierQuery('user-identifier');

// Use in Firestore queries
const queryResults = await Promise.all(
  queryConstraints.map(async ({ field, value }) => {
    const q = query(collection, where(field, '==', value));
    return getDocs(q);
  })
);
```

### Normalizing User Data

```typescript
import { normalizeUserProfileIds } from '@/utils/userIdHelpers';

// Ensures both old and new field names are populated
const standardizedProfile = normalizeUserProfileIds(userProfile);
```

## Best Practices

### When to Use Each Identifier

- **`firebaseUid`**: Use for internal references, database keys, and authentication tasks
- **`username`**: Use for URLs, user-facing references, and social features

### Service Layer Usage

The `UserService` class provides methods for working with user profiles:

```typescript
// Get a user by Firebase UID
const user = await UserService.getUserByFirebaseUid(firebaseUid);

// Get a user by username
const user = await UserService.getUserByUsername(username);

// Both methods return a standardized UserProfile with all fields populated
```

### Component Usage

When displaying user information in components:

```tsx
// Always prefer standardized fields
<UserAvatar username={user.username} name={user.name} />

// Avoid using legacy fields directly
<span>{user.name}</span> // Good
<span>{user.userName}</span> // Avoid
```

## Standardization Process

Shrug is transitioning from inconsistent user field naming to a standardized approach. This process includes:

1. **Field Mapping**: Mapping legacy fields to standardized equivalents
2. **Dual-Field Storage**: Storing both old and new field names during transition
3. **Standardized Service Methods**: Using helpers to normalize data formats
4. **Gradual Component Updates**: Updating React components to use standard field names

### Compatibility Guarantees

During the transition, the application ensures:

- Both old and new field names are populated in data
- Queries can work with either field format
- Helper utilities provide consistent access to user identifiers

## Future Directions

The long-term plan is to fully transition to standardized field names and remove legacy fields. The transition will be completed when:

1. All components exclusively use standardized field names
2. All database queries target standardized fields
3. Usage analytics show no active clients using legacy fields

## FAQs

**Q: Should I use `userID`, `userId`, or `username` in my code?**
A: Always use `username` for the user-chosen identifier and `firebaseUid` for the Firebase UID.

**Q: How do I handle a mix of identifier types in my component?**
A: Use the `detectUserIdentifierType` helper to determine the type, then process accordingly.

**Q: How should URLs be constructed for user profiles?**
A: URLs should use the `username` field: `/profile/[username]`.

## For Further Assistance

If you have questions about user identification in Shrug, contact the development team or refer to the service implementations in:

- `src/services/userService.ts`
- `src/utils/userIdHelpers.ts` 